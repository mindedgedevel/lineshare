(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[192],{1515:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/account/create",function(){return n(9160)}])},5825:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var a=n(5893),s=n(872),i=n.n(s),r=n(5697),c=n.n(r);function l(e){let{onClick:t,disabled:n,className:s,children:i,type:r}=e;return(0,a.jsx)("button",{className:s,onClick:t,disabled:n,type:r,children:i})}l.propTypes={onClick:c().func,disabled:c().bool,className:c().string,type:c().string,children:c().node.isRequired},l.defaultProps={isButton:!1,onClick:()=>{},disabled:!1,className:"py-2 px-4 text-white text-base bg-primary-600 border-2 border-primary-600 rounded cursor-pointer ".concat(i().className),children:"Button",type:"button"}},853:function(e,t,n){"use strict";n.d(t,{Z:function(){return R}});var a=n(5893),s=n(9084),i=n.n(s),r=n(3977),c=n.n(r),l=n(7294),o=n(1163),d=n(4053),u=n(1664),h=n.n(u);let m=[{label:"บัญชีของฉัน",link:"/"}];function x(){let e=(0,o.useRouter)(),[t,n]=(0,l.useState)(!1),{supabaseClient:s,session:r}=(0,d.useSessionContext)(),{auth:u}=s,x=r?r.user:null,f=async()=>{n(!t);let{error:e}=await u.signOut();e&&console.log(e)};return(0,a.jsxs)("header",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"px-8 min-h-[64px] flex items-center justify-between border-b",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold ".concat(i().className),children:"LINE SHARE"}),(0,a.jsxs)("div",{className:"flex flex-col relative",children:[(0,a.jsxs)("div",{onClick:()=>{n(!t)},className:"flex items-center cursor-pointer ".concat(i().className),children:[x&&x.email,(0,a.jsx)("svg",{className:"w-4 h-4 ml-2","aria-hidden":"true",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),(0,a.jsx)("div",{className:"z-10 absolute right-0 top-[110%] bg-white divide-y divide-gray-100 rounded-lg shadow w-44 ".concat(t?"block":"hidden"),children:(0,a.jsx)("ul",{className:"py-2 text-sm text-gray-700",children:(0,a.jsx)("li",{children:(0,a.jsxs)("span",{onClick:f,className:"flex px-4 py-2 hover:bg-gray-100 cursor-pointer gap-2 ".concat(c().className," items-center"),children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#21a93a",viewBox:"0 0 256 256",children:(0,a.jsx)("path",{d:"M116,216a12,12,0,0,1-12,12H48a20,20,0,0,1-20-20V48A20,20,0,0,1,48,28h56a12,12,0,0,1,0,24H52V204h52A12,12,0,0,1,116,216Zm108.49-96.49-40-40a12,12,0,0,0-17,17L187,116H104a12,12,0,0,0,0,24h83l-19.52,19.51a12,12,0,0,0,17,17l40-40A12,12,0,0,0,224.49,119.51Z"})}),"ออกจากระบบ"]})})})})]})]}),(0,a.jsx)("div",{className:"px-8 flex items-center border-b",children:(0,a.jsx)("nav",{children:(0,a.jsx)("ul",{className:"flex gap-4 ".concat(c().className),children:e.pathname.includes("/admin")?(0,a.jsx)("li",{className:"px-4 py-3 active border-b-4 border-primary-600",children:(0,a.jsx)(h(),{href:"/admin/settings/account",children:"ตั้งค่า"})}):m.map((t,n)=>(0,a.jsx)("li",{className:"px-4 py-3 ".concat(e.pathname===t.link?"active border-b-4 border-primary-600":""),children:(0,a.jsx)(h(),{href:t.link,children:t.label})},n))})})})]})}function f(){return(0,a.jsx)("footer",{className:"px-4 flex items-center border-t",children:(0,a.jsxs)("p",{className:"text-xs text-gray-400 my-2",children:["\xa9",new Date().getFullYear()," Mindedge Co., Ltd."]})})}var p=n(3415),g=n.n(p),b=n(5675),j=n.n(b),_={src:"/_next/static/media/i-link-simple.488b4213.svg",height:32,width:32,blurWidth:0,blurHeight:0},y={src:"/_next/static/media/i-list-dashes.99f19d3d.svg",height:32,width:32,blurWidth:0,blurHeight:0},N={src:"/_next/static/media/i-megaphone.6b0241ef.svg",height:32,width:32,blurWidth:0,blurHeight:0},w={src:"/_next/static/media/i-magic-wand.50682af5.svg",height:32,width:32,blurWidth:0,blurHeight:0},v={src:"/_next/static/media/i-user-circle.e159f561.svg",height:32,width:32,blurWidth:0,blurHeight:0};function k(){let e=(0,o.useRouter)(),[t,n]=(0,l.useState)(""),s=window.sessionStorage.getItem("acid"),[i,r]=(0,l.useState)({Settings:[{id:"link-account",label:"ลิงก์บัญชี",link:"/settings/link-account",image:_}],Account:[{id:"home-account",label:"Dashboard",link:"/account/".concat(s),image:y},{id:"campaign",label:"แคมเปญทั้งหมด",link:"/account/".concat(s,"/campaign"),image:N},{id:"insight",label:"ข้อมูลเชิงลึก",link:"/account/".concat(s,"/campaign/insight"),image:w}]});return(0,l.useEffect)(()=>{e.pathname.includes("/account")&&!e.pathname.includes("/account/create")?n("Account"):n("")},[e.pathname]),(0,a.jsx)("nav",{className:"md:w-[280px] p-11 bg-gray-50 border-r border-gray-200",children:e.pathname.includes("/admin")?(0,a.jsxs)("ul",{className:"flex flex-col gap-4 ".concat(g().className),children:[(0,a.jsx)("li",{children:(0,a.jsxs)(h(),{href:"/admin/settings/account",className:"flex gap-2",children:[(0,a.jsx)(j(),{src:_,width:24,height:24,alt:"Account"}),"บัญชีทางการ"]})}),(0,a.jsx)("li",{children:(0,a.jsxs)(h(),{href:"/admin/settings/users",className:"flex gap-2",children:[(0,a.jsx)(j(),{src:v,width:24,height:24,alt:"Campaign"}),"ผู้ใช้งาน"]})})]}):""!==t&&(0,a.jsx)("ul",{className:"flex flex-col gap-4 ".concat(g().className),children:i[t].map((e,t)=>(0,a.jsx)("li",{children:(0,a.jsxs)(h(),{href:e.link,className:"flex gap-2",children:[(0,a.jsx)(j(),{src:e.image,width:24,height:24,alt:"Insight"}),e.label]})},t))})})}var C=n(1678),S=n.n(C),T=n(5825);function B(e){return e.setButton&&e.setButton.isButton,(0,a.jsxs)("section",{className:"flex justify-between mb-10",children:[(0,a.jsx)("h1",{className:"text-3xl ".concat(S().className),children:e.setPageTitle}),e.setButton&&(0,a.jsx)("div",{children:(0,a.jsx)(T.Z,{onClick:e.setButton.onClick,disabled:e.setButton.disabled,className:e.setButton.className,children:e.setButton.children})})]})}function R(e){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x,{}),(0,a.jsxs)("main",{className:"flex flex-row no-warp items-stretch min-h-[calc(100vh-146px)]",children:[(0,a.jsx)(k,{}),(0,a.jsxs)("div",{className:"content w-full max-w-[1160px] p-11",children:[(0,a.jsx)(B,{setPageTitle:e.setPageTitle,setButton:e.setButton}),e.children]})]}),(0,a.jsx)(f,{})]})}},6098:function(e,t,n){"use strict";n.d(t,{RQ:function(){return o},S_:function(){return h},Sv:function(){return d},_Z:function(){return c},gz:function(){return m},uL:function(){return u}});var a=n(6637),s=n(7632);let i="https://api.line.me/v2",r="https://node-red.guka.dev";async function c(e,t){if(!e&&!t)return null;let n=await fetch("".concat(i,"/oauth/accessToken"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"client_credentials",client_id:e,client_secret:t})});return n.json()}async function l(e){if(!e)return null;let t=await fetch("".concat(i,"/oauth/verify"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({access_token:e})});return t.json()}async function o(e){let{data:t,error:n}=await a.g.from("shops").select("*").eq("id",e);if(n)return null;let s=await l(t[0].access_data.access_token);if(s.error_description){let n=await c(t[0].chanel_id,t[0].chanel_secret);return await a.g.from("shops").update({access_data:n}).eq("id",e),n.access_token}return t[0].access_data.access_token}async function d(e){if(!e)return null;let t=await fetch("".concat(r,"/line/api/getbotinfo"),{headers:{"Content-Type":"application/json",Authorization:"Bearer "+e}});return t.json()}async function u(e){if(!e)return null;let t=await fetch("".concat(r,"/line/api/getaudiences"),{headers:{"Content-Type":"application/json",Authorization:"Bearer "+e}});return t.json()}async function h(e,t){if(!e)return null;let n=await fetch("".concat(r,"/line/api/sendbcall"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e,"X-Line-Retry-Key":(0,s.Z)()},body:JSON.stringify({messages:[t]})});return n.json()}async function m(e,t,n){if(!e)return null;let a=await fetch("".concat(r,"/line/api/sendbcaudience"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e,"X-Line-Retry-Key":(0,s.Z)()},body:JSON.stringify({messages:[t],recipient:{type:"operator",and:[{type:"audience",audienceGroupId:n}]}})});return a.json()}},9160:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var a=n(5893),s=n(2333),i=n.n(s),r=n(7294),c=n(2175),l=n(6310),o=n(4053),d=n(6098),u=n(853);let h=e=>{let{router:t}=e,[n,s]=(0,r.useState)(null),u=(0,o.useSupabaseClient)(),h=(0,o.useUser)(),m=(0,c.TA)({initialValues:{name:"",chanel_id:"",chanel_secret:"",liff_id:""},validationSchema:l.Ry().shape({name:l.Z_().min(2,"Too Short!").max(250,"Too Long!").required("Required"),chanel_id:l.Z_().required("Required"),chanel_secret:l.Z_().required("Required"),liff_id:l.Z_().required("Required")}),onSubmit:e=>{x(e)}}),x=async e=>{e.user_id=h.id;let{data:n,error:a}=await u.from("shops").select("chanel_id").eq("chanel_id",e.chanel_id);if(n.length&&n[0].chanel_id){s("ไม่สามารถเพิ่มได้ ร้านค้านี้มีในระบบหรือถูกเพิ่มไปแล้ว");return}let i=await (0,d._Z)(e.chanel_id,e.chanel_secret);if(!i){s("ข้อมูล Line ไม่ถูกต้อง");return}e.access_data=i;let r=await u.from("shops").insert(e).select();if(r.error){s(r.error.message);return}t.push("/")};return(0,a.jsxs)("form",{noValidate:!0,onSubmit:e=>{e.preventDefault(),m.handleSubmit()},className:"flex flex-col gap-3 max-w-md",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("label",{htmlFor:"name",className:"".concat(i().className," font-medium"),children:"Account Name"}),(0,a.jsx)("input",{id:"name",type:"text",name:"name",className:"border p-2 rounded",onChange:m.handleChange,value:m.values.name}),m.errors.name&&m.touched.name?(0,a.jsx)("div",{className:"text-red-500 text-xs",children:m.errors.name}):null]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("label",{htmlFor:"chanel_id",className:"".concat(i().className," font-medium"),children:"Chanel ID"}),(0,a.jsx)("input",{id:"chanel_id",type:"text",name:"chanel_id",className:"border p-2 rounded",onChange:m.handleChange,value:m.values.chanel_id}),m.errors.chanel_id&&m.touched.chanel_id?(0,a.jsx)("div",{className:"text-red-500 text-xs",children:m.errors.chanel_id}):null]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("label",{htmlFor:"chanel_secret",className:"".concat(i().className," font-medium"),children:"Chanel Secret"}),(0,a.jsx)("input",{id:"chanel_secret",type:"text",name:"chanel_secret",className:"border p-2 rounded",onChange:m.handleChange,value:m.values.chanel_secret}),m.errors.chanel_secret&&m.touched.chanel_secret?(0,a.jsx)("div",{className:"text-red-500 text-xs",children:m.errors.chanel_secret}):null]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("label",{htmlFor:"liff_id",className:"".concat(i().className," font-medium"),children:"Liff ID"}),(0,a.jsx)("input",{id:"liff_id",type:"text",name:"liff_id",className:"border p-2 rounded",onChange:m.handleChange,value:m.values.liff_id}),m.errors.liff_id&&m.touched.liff_id?(0,a.jsx)("div",{className:"text-red-500 text-xs",children:m.errors.liff_id}):null]}),(0,a.jsx)("input",{type:"submit",className:"bg-primary-600 py-2 px-4 text-primary-100 text-sm rounded-md cursor-pointer disabled:opacity-50 disabled:hover:cursor-not-allowed ".concat(i().className),value:"บันทึก"}),n&&(0,a.jsx)("div",{className:"py-2 border border-red-500 rounded-md bg-red-100",children:(0,a.jsx)("span",{className:"text-sm text-red-900 px-2",children:n})})]})};function m(e){let{router:t}=e;return(0,a.jsx)(u.Z,{setPageTitle:"ลิงค์บัญชีใหม่",children:(0,a.jsx)(h,{router:t})})}m.requireAuth=!0,m.role=["authenticated"]},2333:function(e){e.exports={style:{fontFamily:"'__Anuphan_87802c'",fontStyle:"normal"},className:"__className_87802c"}},7632:function(e,t,n){"use strict";let a;n.d(t,{Z:function(){return o}});let s="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var i={randomUUID:s};let r=new Uint8Array(16);function c(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(r)}let l=[];for(let e=0;e<256;++e)l.push((e+256).toString(16).slice(1));var o=function(e,t,n){if(i.randomUUID&&!t&&!e)return i.randomUUID();e=e||{};let a=e.random||(e.rng||c)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=a[e];return t}return function(e,t=0){return(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase()}(a)}}},function(e){e.O(0,[747,743,774,888,179],function(){return e(e.s=1515)}),_N_E=e.O()}]);