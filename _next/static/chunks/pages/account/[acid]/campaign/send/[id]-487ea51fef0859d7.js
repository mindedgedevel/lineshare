(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[134],{5048:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/account/[acid]/campaign/send/[id]",function(){return a(7504)}])},5825:function(e,t,a){"use strict";a.d(t,{Z:function(){return c}});var n=a(5893),s=a(872),i=a.n(s),r=a(5697),l=a.n(r);function c(e){let{onClick:t,disabled:a,className:s,children:i,type:r}=e;return(0,n.jsx)("button",{className:s,onClick:t,disabled:a,type:r,children:i})}c.propTypes={onClick:l().func,disabled:l().bool,className:l().string,type:l().string,children:l().node.isRequired},c.defaultProps={isButton:!1,onClick:()=>{},disabled:!1,className:"py-2 px-4 text-white text-base bg-primary-600 border-2 border-primary-600 rounded cursor-pointer ".concat(i().className),children:"Button",type:"button"}},853:function(e,t,a){"use strict";a.d(t,{Z:function(){return A}});var n=a(5893),s=a(9084),i=a.n(s),r=a(3977),l=a.n(r),c=a(7294),o=a(1163),d=a(4053),u=a(1664),h=a.n(u);let m=[{label:"บัญชีของฉัน",link:"/"}];function x(){let e=(0,o.useRouter)(),[t,a]=(0,c.useState)(!1),{supabaseClient:s,session:r}=(0,d.useSessionContext)(),{auth:u}=s,x=r?r.user:null,g=async()=>{a(!t);let{error:e}=await u.signOut();e&&console.log(e)};return(0,n.jsxs)("header",{className:"flex flex-col",children:[(0,n.jsxs)("div",{className:"px-8 min-h-[64px] flex items-center justify-between border-b",children:[(0,n.jsx)("h1",{className:"text-2xl font-semibold ".concat(i().className),children:"LINE SHARE"}),(0,n.jsxs)("div",{className:"flex flex-col relative",children:[(0,n.jsxs)("div",{onClick:()=>{a(!t)},className:"flex items-center cursor-pointer ".concat(i().className),children:[x&&x.email,(0,n.jsx)("svg",{className:"w-4 h-4 ml-2","aria-hidden":"true",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,n.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),(0,n.jsx)("div",{className:"z-10 absolute right-0 top-[110%] bg-white divide-y divide-gray-100 rounded-lg shadow w-44 ".concat(t?"block":"hidden"),children:(0,n.jsx)("ul",{className:"py-2 text-sm text-gray-700",children:(0,n.jsx)("li",{children:(0,n.jsxs)("span",{onClick:g,className:"flex px-4 py-2 hover:bg-gray-100 cursor-pointer gap-2 ".concat(l().className," items-center"),children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#21a93a",viewBox:"0 0 256 256",children:(0,n.jsx)("path",{d:"M116,216a12,12,0,0,1-12,12H48a20,20,0,0,1-20-20V48A20,20,0,0,1,48,28h56a12,12,0,0,1,0,24H52V204h52A12,12,0,0,1,116,216Zm108.49-96.49-40-40a12,12,0,0,0-17,17L187,116H104a12,12,0,0,0,0,24h83l-19.52,19.51a12,12,0,0,0,17,17l40-40A12,12,0,0,0,224.49,119.51Z"})}),"ออกจากระบบ"]})})})})]})]}),(0,n.jsx)("div",{className:"px-8 flex items-center border-b",children:(0,n.jsx)("nav",{children:(0,n.jsx)("ul",{className:"flex gap-4 ".concat(l().className),children:e.pathname.includes("/admin")?(0,n.jsx)("li",{className:"px-4 py-3 active border-b-4 border-primary-600",children:(0,n.jsx)(h(),{href:"/admin/settings/account",children:"ตั้งค่า"})}):m.map((t,a)=>(0,n.jsx)("li",{className:"px-4 py-3 ".concat(e.pathname===t.link?"active border-b-4 border-primary-600":""),children:(0,n.jsx)(h(),{href:t.link,children:t.label})},a))})})})]})}function g(){return(0,n.jsx)("footer",{className:"px-4 flex items-center border-t",children:(0,n.jsxs)("p",{className:"text-xs text-gray-400 my-2",children:["\xa9",new Date().getFullYear()," Mindedge Co., Ltd."]})})}var p=a(3415),f=a.n(p),j=a(5675),w=a.n(j),b={src:"/_next/static/media/i-link-simple.488b4213.svg",height:32,width:32,blurWidth:0,blurHeight:0},v={src:"/_next/static/media/i-list-dashes.99f19d3d.svg",height:32,width:32,blurWidth:0,blurHeight:0},y={src:"/_next/static/media/i-megaphone.6b0241ef.svg",height:32,width:32,blurWidth:0,blurHeight:0},N={src:"/_next/static/media/i-magic-wand.50682af5.svg",height:32,width:32,blurWidth:0,blurHeight:0},_={src:"/_next/static/media/i-user-circle.e159f561.svg",height:32,width:32,blurWidth:0,blurHeight:0};function k(){let e=(0,o.useRouter)(),[t,a]=(0,c.useState)(""),s=window.sessionStorage.getItem("acid"),[i,r]=(0,c.useState)({Settings:[{id:"link-account",label:"ลิงก์บัญชี",link:"/settings/link-account",image:b}],Account:[{id:"home-account",label:"Dashboard",link:"/account/".concat(s),image:v},{id:"campaign",label:"แคมเปญทั้งหมด",link:"/account/".concat(s,"/campaign"),image:y},{id:"insight",label:"ข้อมูลเชิงลึก",link:"/account/".concat(s,"/campaign/insight"),image:N}]});return(0,c.useEffect)(()=>{e.pathname.includes("/account")&&!e.pathname.includes("/account/create")?a("Account"):a("")},[e.pathname]),(0,n.jsx)("nav",{className:"md:w-[280px] p-11 bg-gray-50 border-r border-gray-200",children:e.pathname.includes("/admin")?(0,n.jsxs)("ul",{className:"flex flex-col gap-4 ".concat(f().className),children:[(0,n.jsx)("li",{children:(0,n.jsxs)(h(),{href:"/admin/settings/account",className:"flex gap-2",children:[(0,n.jsx)(w(),{src:b,width:24,height:24,alt:"Account"}),"บัญชีทางการ"]})}),(0,n.jsx)("li",{children:(0,n.jsxs)(h(),{href:"/admin/settings/users",className:"flex gap-2",children:[(0,n.jsx)(w(),{src:_,width:24,height:24,alt:"Campaign"}),"ผู้ใช้งาน"]})})]}):""!==t&&(0,n.jsx)("ul",{className:"flex flex-col gap-4 ".concat(f().className),children:i[t].map((e,t)=>(0,n.jsx)("li",{children:(0,n.jsxs)(h(),{href:e.link,className:"flex gap-2",children:[(0,n.jsx)(w(),{src:e.image,width:24,height:24,alt:"Insight"}),e.label]})},t))})})}var S=a(1678),C=a.n(S),B=a(5825);function T(e){return e.setButton&&e.setButton.isButton,(0,n.jsxs)("section",{className:"flex justify-between mb-10",children:[(0,n.jsx)("h1",{className:"text-3xl ".concat(C().className),children:e.setPageTitle}),e.setButton&&(0,n.jsx)("div",{children:(0,n.jsx)(B.Z,{onClick:e.setButton.onClick,disabled:e.setButton.disabled,className:e.setButton.className,children:e.setButton.children})})]})}function A(e){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(x,{}),(0,n.jsxs)("main",{className:"flex flex-row no-warp items-stretch min-h-[calc(100vh-146px)]",children:[(0,n.jsx)(k,{}),(0,n.jsxs)("div",{className:"content w-full max-w-[1160px] p-11",children:[(0,n.jsx)(T,{setPageTitle:e.setPageTitle,setButton:e.setButton}),e.children]})]}),(0,n.jsx)(g,{})]})}},6098:function(e,t,a){"use strict";a.d(t,{RQ:function(){return o},S_:function(){return h},Sv:function(){return d},_Z:function(){return l},gz:function(){return m},uL:function(){return u}});var n=a(6637),s=a(7632);let i="https://api.line.me/v2",r="https://node-red.guka.dev";async function l(e,t){if(!e&&!t)return null;let a=await fetch("".concat(i,"/oauth/accessToken"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"client_credentials",client_id:e,client_secret:t})});return a.json()}async function c(e){if(!e)return null;let t=await fetch("".concat(i,"/oauth/verify"),{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({access_token:e})});return t.json()}async function o(e){let{data:t,error:a}=await n.g.from("shops").select("*").eq("id",e);if(a)return null;let s=await c(t[0].access_data.access_token);if(s.error_description){let a=await l(t[0].chanel_id,t[0].chanel_secret);return await n.g.from("shops").update({access_data:a}).eq("id",e),a.access_token}return t[0].access_data.access_token}async function d(e){if(!e)return null;let t=await fetch("".concat(r,"/line/api/getbotinfo"),{headers:{"Content-Type":"application/json",Authorization:"Bearer "+e}});return t.json()}async function u(e){if(!e)return null;let t=await fetch("".concat(r,"/line/api/getaudiences"),{headers:{"Content-Type":"application/json",Authorization:"Bearer "+e}});return t.json()}async function h(e,t){if(!e)return null;let a=await fetch("".concat(r,"/line/api/sendbcall"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e,"X-Line-Retry-Key":(0,s.Z)()},body:JSON.stringify({messages:[t]})});return a.json()}async function m(e,t,a){if(!e)return null;let n=await fetch("".concat(r,"/line/api/sendbcaudience"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+e,"X-Line-Retry-Key":(0,s.Z)()},body:JSON.stringify({messages:[t],recipient:{type:"operator",and:[{type:"audience",audienceGroupId:a}]}})});return n.json()}},7504:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var n=a(5893),s=a(7294),i=a(4053),r=a(853),l=a(7238),c=a.n(l),o=a(6098),d=a(2175),u=a(6310),h=a(5660),m=a.n(h);function x(e){let{campaign:t}=e,[a,r]=(0,s.useState)(null),[l,h]=(0,s.useState)(!1),[x,g]=(0,s.useState)([]),[p,f]=(0,s.useState)(!1),j=(0,i.useSupabaseClient)(),w=window.sessionStorage.getItem("acid"),b=(0,d.TA)({initialValues:{target:"",audience:""},validationSchema:u.Ry().shape({target:u.Z_().required("Required"),audience:u.Z_().required("Required")}),onSubmit:async e=>{if(f(!0),"all"===e.target){let e=await (0,o.RQ)(w),a=await (0,o.S_)(e,t.flexmsg);if(200==a.status){f(!1),await j.from("reports").insert({data:a,event_name:"SendBcAll",event_value:1,camp_id:t.id}),alert("ส่งสำเร็จแล้ว");return}}if("audienc"===e.target){let a=await (0,o.RQ)(w),n=await (0,o.gz)(a,t.flexmsg,e.audience);if(200==n.status){f(!1),await j.from("reports").insert({data:n,event_name:"SendBcAudience",event_value:1,camp_id:t.id}),alert("ส่งสำเร็จแล้ว");return}}f(!1)}});return(0,s.useEffect)(()=>{let e=m().highlight(JSON.stringify(t.flexmsg?t.flexmsg:{},!0,2),m().languages.javascript,"json");r(e)},[t]),(0,s.useEffect)(()=>{let e=async()=>{if(!w)return null;let e=await (0,o.RQ)(w),t=await (0,o.uL)(e);g(t)};e()},[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"w-1/2 p-4 min-h-[400px]",children:(0,n.jsx)("img",{alt:"Cover",className:"rounded-xl",src:t.image_url?t.image_url:"https://placehold.co/1080x1080",width:600,height:320})}),(0,n.jsx)("div",{className:"w-1/2 p-4 ".concat(c().className),children:(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),b.handleSubmit()},children:[(0,n.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("label",{htmlFor:"traget",className:"font-medium",children:"Target"}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsxs)("select",{className:"block appearance-none w-full bg-gray-200 border border-gray-200 text-gray-700 py-3 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500",id:"traget",name:"target",onChange:e=>{"all"===e.target.value&&b.setFieldValue("audience","all"),b.setFieldValue("target",e.target.value)},value:b.values.target,children:[(0,n.jsx)("option",{value:"",children:"ยังไม่เลือก"}),(0,n.jsx)("option",{value:"all",children:"ทั้งหมดที่เป็นเพื่อน"}),(0,n.jsx)("option",{value:"audienc",children:"กลุ่มเป้าหมาย"})]}),(0,n.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:(0,n.jsx)("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]}),b.errors.target&&b.touched.target?(0,n.jsx)("div",{className:"text-red-500 text-xs",children:b.errors.target}):null]}),"audienc"===b.values.target&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("label",{htmlFor:"aud",className:"font-medium",children:"กลุ่มเป้าหมาย"}),(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsxs)("select",{className:"block appearance-none w-full bg-gray-200 border border-gray-200 text-gray-700 py-3 px-4 pr-8 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500",id:"aud",name:"audience",onChange:b.handleChange,value:b.values.audience,children:[(0,n.jsx)("option",{value:"",children:"ยังไม่เลือก"}),x&&x.audienceGroups.length&&x.audienceGroups.map((e,t)=>(0,n.jsx)("option",{value:e.audienceGroupId,children:e.description+" จำนวน ".concat(e.audienceCount," คน")},t))]}),(0,n.jsx)("div",{className:"pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700",children:(0,n.jsx)("svg",{className:"fill-current h-4 w-4",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",children:(0,n.jsx)("path",{d:"M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"})})})]}),b.errors.audience&&b.touched.audience?(0,n.jsx)("div",{className:"text-red-500 text-xs",children:b.errors.audience}):null]}),(0,n.jsxs)("label",{htmlFor:"json",className:"font-medium mt-4 flex gap-2 items-center",children:["JSON Code",(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",fill:"#a1a1a1",viewBox:"0 0 256 256",className:"cursor-pointer",onClick:()=>h(!l),children:(0,n.jsx)("path",{d:"M247.31,124.76c-.35-.79-8.82-19.58-27.65-38.41C194.57,61.26,162.88,48,128,48S61.43,61.26,36.34,86.35C17.51,105.18,9,124,8.69,124.76a8,8,0,0,0,0,6.5c.35.79,8.82,19.57,27.65,38.4C61.43,194.74,93.12,208,128,208s66.57-13.26,91.66-38.34c18.83-18.83,27.3-37.61,27.65-38.4A8,8,0,0,0,247.31,124.76ZM128,192c-30.78,0-57.67-11.19-79.93-33.25A133.47,133.47,0,0,1,25,128,133.33,133.33,0,0,1,48.07,97.25C70.33,75.19,97.22,64,128,64s57.67,11.19,79.93,33.25A133.46,133.46,0,0,1,231.05,128C223.84,141.46,192.43,192,128,192Zm0-112a48,48,0,1,0,48,48A48.05,48.05,0,0,0,128,80Zm0,80a32,32,0,1,1,32-32A32,32,0,0,1,128,160Z"})})]}),l&&(0,n.jsx)("div",{className:"max-h-[500px] overflow-auto",children:(0,n.jsx)("pre",{className:"language-json",tabIndex:0,children:(0,n.jsx)("code",{className:"language-json",dangerouslySetInnerHTML:{__html:a}})})})]}),(0,n.jsx)("button",{type:"submit",className:"rounded-md w-full px-4 py-2 mt-4 text-sm bg-green-500 text-white border-none cursor-pointer",children:p?"กำลังส่ง...":"ส่ง"})]})})]})}function g(e){let{router:t}=e,[a,l]=(0,s.useState)({}),c=(0,i.useSupabaseClient)();(0,s.useEffect)(()=>{t.query.id&&o(t.query.id)},[t.query]);let o=async e=>{let{data:t,error:a}=await c.from("campaigns").select("*").eq("id",e);if(a){alert(a.message);return}l(t[0])};return(0,n.jsx)(r.Z,{setPageTitle:"ส่งแคมเปญ",children:(0,n.jsx)("div",{className:"flex flex-nowrap",children:(0,n.jsx)(x,{campaign:a})})})}a(4563)}},function(e){e.O(0,[747,743,629,774,888,179],function(){return e(e.s=5048)}),_N_E=e.O()}]);