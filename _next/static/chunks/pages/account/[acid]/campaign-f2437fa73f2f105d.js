(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[197],{9909:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/account/[acid]/campaign",function(){return s(2723)}])},5825:function(e,t,s){"use strict";s.d(t,{Z:function(){return r}});var a=s(5893),c=s(872),n=s.n(c),l=s(5697),i=s.n(l);function r(e){let{onClick:t,disabled:s,className:c,children:n,type:l}=e;return(0,a.jsx)("button",{className:c,onClick:t,disabled:s,type:l,children:n})}r.propTypes={onClick:i().func,disabled:i().bool,className:i().string,type:i().string,children:i().node.isRequired},r.defaultProps={isButton:!1,onClick:()=>{},disabled:!1,className:"py-2 px-4 text-white text-base bg-primary-600 border-2 border-primary-600 rounded cursor-pointer ".concat(n().className),children:"Button",type:"button"}},853:function(e,t,s){"use strict";s.d(t,{Z:function(){return E}});var a=s(5893),c=s(9084),n=s.n(c),l=s(3977),i=s.n(l),r=s(7294),o=s(1163),d=s(4053),h=s(1664),x=s.n(h);let m=[{label:"บัญชีของฉัน",link:"/"}];function u(){let e=(0,o.useRouter)(),[t,s]=(0,r.useState)(!1),{supabaseClient:c,session:l}=(0,d.useSessionContext)(),{auth:h}=c,u=l?l.user:null,p=async()=>{s(!t);let{error:e}=await h.signOut();e&&console.log(e)};return(0,a.jsxs)("header",{className:"flex flex-col",children:[(0,a.jsxs)("div",{className:"px-8 min-h-[64px] flex items-center justify-between border-b",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold ".concat(n().className),children:"LINE SHARE"}),(0,a.jsxs)("div",{className:"flex flex-col relative",children:[(0,a.jsxs)("div",{onClick:()=>{s(!t)},className:"flex items-center cursor-pointer ".concat(n().className),children:[u&&u.email,(0,a.jsx)("svg",{className:"w-4 h-4 ml-2","aria-hidden":"true",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),(0,a.jsx)("div",{className:"z-10 absolute right-0 top-[110%] bg-white divide-y divide-gray-100 rounded-lg shadow w-44 ".concat(t?"block":"hidden"),children:(0,a.jsx)("ul",{className:"py-2 text-sm text-gray-700",children:(0,a.jsx)("li",{children:(0,a.jsxs)("span",{onClick:p,className:"flex px-4 py-2 hover:bg-gray-100 cursor-pointer gap-2 ".concat(i().className," items-center"),children:[(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"#21a93a",viewBox:"0 0 256 256",children:(0,a.jsx)("path",{d:"M116,216a12,12,0,0,1-12,12H48a20,20,0,0,1-20-20V48A20,20,0,0,1,48,28h56a12,12,0,0,1,0,24H52V204h52A12,12,0,0,1,116,216Zm108.49-96.49-40-40a12,12,0,0,0-17,17L187,116H104a12,12,0,0,0,0,24h83l-19.52,19.51a12,12,0,0,0,17,17l40-40A12,12,0,0,0,224.49,119.51Z"})}),"ออกจากระบบ"]})})})})]})]}),(0,a.jsx)("div",{className:"px-8 flex items-center border-b",children:(0,a.jsx)("nav",{children:(0,a.jsx)("ul",{className:"flex gap-4 ".concat(i().className),children:e.pathname.includes("/admin")?(0,a.jsx)("li",{className:"px-4 py-3 active border-b-4 border-primary-600",children:(0,a.jsx)(x(),{href:"/admin/settings/account",children:"ตั้งค่า"})}):m.map((t,s)=>(0,a.jsx)("li",{className:"px-4 py-3 ".concat(e.pathname===t.link?"active border-b-4 border-primary-600":""),children:(0,a.jsx)(x(),{href:t.link,children:t.label})},s))})})})]})}function p(){return(0,a.jsx)("footer",{className:"px-4 flex items-center border-t",children:(0,a.jsxs)("p",{className:"text-xs text-gray-400 my-2",children:["\xa9",new Date().getFullYear()," Mindedge Co., Ltd."]})})}var g=s(3415),f=s.n(g),j=s(5675),N=s.n(j),b={src:"/_next/static/media/i-link-simple.488b4213.svg",height:32,width:32,blurWidth:0,blurHeight:0},w={src:"/_next/static/media/i-list-dashes.99f19d3d.svg",height:32,width:32,blurWidth:0,blurHeight:0},y={src:"/_next/static/media/i-megaphone.6b0241ef.svg",height:32,width:32,blurWidth:0,blurHeight:0},v={src:"/_next/static/media/i-magic-wand.50682af5.svg",height:32,width:32,blurWidth:0,blurHeight:0},k={src:"/_next/static/media/i-user-circle.e159f561.svg",height:32,width:32,blurWidth:0,blurHeight:0};function _(){let e=(0,o.useRouter)(),[t,s]=(0,r.useState)(""),c=window.sessionStorage.getItem("acid"),[n,l]=(0,r.useState)({Settings:[{id:"link-account",label:"ลิงก์บัญชี",link:"/settings/link-account",image:b}],Account:[{id:"home-account",label:"Dashboard",link:"/account/".concat(c),image:w},{id:"campaign",label:"แคมเปญทั้งหมด",link:"/account/".concat(c,"/campaign"),image:y},{id:"insight",label:"ข้อมูลเชิงลึก",link:"/account/".concat(c,"/campaign/insight"),image:v}]});return(0,r.useEffect)(()=>{e.pathname.includes("/account")&&!e.pathname.includes("/account/create")?s("Account"):s("")},[e.pathname]),(0,a.jsx)("nav",{className:"md:w-[280px] p-11 bg-gray-50 border-r border-gray-200",children:e.pathname.includes("/admin")?(0,a.jsxs)("ul",{className:"flex flex-col gap-4 ".concat(f().className),children:[(0,a.jsx)("li",{children:(0,a.jsxs)(x(),{href:"/admin/settings/account",className:"flex gap-2",children:[(0,a.jsx)(N(),{src:b,width:24,height:24,alt:"Account"}),"บัญชีทางการ"]})}),(0,a.jsx)("li",{children:(0,a.jsxs)(x(),{href:"/admin/settings/users",className:"flex gap-2",children:[(0,a.jsx)(N(),{src:k,width:24,height:24,alt:"Campaign"}),"ผู้ใช้งาน"]})})]}):""!==t&&(0,a.jsx)("ul",{className:"flex flex-col gap-4 ".concat(f().className),children:n[t].map((e,t)=>(0,a.jsx)("li",{children:(0,a.jsxs)(x(),{href:e.link,className:"flex gap-2",children:[(0,a.jsx)(N(),{src:e.image,width:24,height:24,alt:"Insight"}),e.label]})},t))})})}var C=s(1678),B=s.n(C),S=s(5825);function L(e){return e.setButton&&e.setButton.isButton,(0,a.jsxs)("section",{className:"flex justify-between mb-10",children:[(0,a.jsx)("h1",{className:"text-3xl ".concat(B().className),children:e.setPageTitle}),e.setButton&&(0,a.jsx)("div",{children:(0,a.jsx)(S.Z,{onClick:e.setButton.onClick,disabled:e.setButton.disabled,className:e.setButton.className,children:e.setButton.children})})]})}function E(e){return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(u,{}),(0,a.jsxs)("main",{className:"flex flex-row no-warp items-stretch min-h-[calc(100vh-146px)]",children:[(0,a.jsx)(_,{}),(0,a.jsxs)("div",{className:"content w-full max-w-[1160px] p-11",children:[(0,a.jsx)(L,{setPageTitle:e.setPageTitle,setButton:e.setButton}),e.children]})]}),(0,a.jsx)(p,{})]})}},2723:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return m}});var a=s(5893),c=s(7294),n=s(4053),l=s(853),i=s(5272),r=s.n(i),o=s(1664),d=s.n(o),h=s(4238);function x(e){let{campaigns:t,reports:s,deleteCampaign:n}=e,l=window.sessionStorage.getItem("acid");(0,c.useEffect)(()=>{new h.Z(".view-cp a",{overlayOpacity:.9})},[t]);let i=(e,t)=>e.find(e=>e.camp_id===t);return(0,a.jsx)("div",{className:"overflow-hidden rounded-lg border border-gray-200",children:(0,a.jsxs)("table",{className:"w-full border-collapse bg-white text-left text-sm text-gray-500",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{scope:"col",className:"px-6 py-4 text-sm text-gray-900 ".concat(r().className),children:"SceenShot"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-4 text-sm text-gray-900 ".concat(r().className),children:"ชื่อแคมเปญ"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-4 text-sm text-gray-900 ".concat(r().className),children:"ดูแคมเปญ"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-4 text-sm text-gray-900 ".concat(r().className),children:"แชร์"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-4 text-sm text-gray-900 ".concat(r().className),children:"ได้รับคูปอง"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-4 text-sm text-gray-900 ".concat(r().className),children:"ใช้สิทธิ์"}),(0,a.jsx)("th",{scope:"col",className:"px-6 py-4 text-right text-sm text-gray-900"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-100 border-t border-gray-100",children:t.length>0?t.map((e,t)=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"p-2 font-normal text-gray-900",children:(0,a.jsx)("div",{className:"view-cp gallery",children:(0,a.jsx)("a",{href:e.image_url?e.image_url:"https://placehold.co/220x220",children:(0,a.jsx)("img",{className:"w-[220px] h-auto object-cover object-center",src:e.image_url?e.image_url:"https://placehold.co/220x220",alt:"image screenshot"})})})}),(0,a.jsxs)("td",{className:"px-6 py-4 font-normal text-gray-900 ".concat(r().className),children:[e.name,(0,a.jsx)("br",{}),(0,a.jsxs)("span",{className:"text-xs text-gray-400 ".concat(r().className),children:["สร้างเมื่อ"," ",new Date(e.created_at).toLocaleString("th-TH")]})]}),(0,a.jsx)("td",{className:"px-6 py-4 text-gray-800",children:s.length&&i(s,e.id).view}),(0,a.jsx)("td",{className:"px-6 py-4 text-gray-800",children:s.length&&i(s,e.id).share}),(0,a.jsx)("td",{className:"px-6 py-4 text-gray-800",children:s.length&&i(s,e.id).rg}),(0,a.jsx)("td",{className:"px-6 py-4 text-gray-800",children:s.length&&i(s,e.id).isuse}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)(d(),{"x-data":"{ tooltip: 'Send' }",href:"/account/".concat(l,"/campaign/send/").concat(e.id),title:"Send BC",children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"25",height:"25",fill:"#6b7180",viewBox:"0 0 256 256",children:(0,a.jsx)("path",{d:"M227.32,28.68a16,16,0,0,0-15.66-4.08l-.15,0L19.57,82.84a16,16,0,0,0-2.42,29.84l85.62,40.55,40.55,85.62A15.86,15.86,0,0,0,157.74,248q.69,0,1.38-.06a15.88,15.88,0,0,0,14-11.51l58.2-191.94c0-.05,0-.1,0-.15A16,16,0,0,0,227.32,28.68ZM157.83,231.85l-.05.14L118.42,148.9l47.24-47.25a8,8,0,0,0-11.31-11.31L107.1,137.58,24,98.22l.14,0L216,40Z"})})}),(0,a.jsx)("div",{className:"cursor-pointer",onClick:()=>{n(e)},children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"h-6 w-6","x-tooltip":"tooltip",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"})})})]})})]},t)):(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:"7",children:(0,a.jsx)("p",{className:"text-center p-4 ".concat(r().className),children:"ไม่มีข้อมูล"})})})})]})})}function m(e){let{router:t}=e,[s,i]=(0,c.useState)([]),[r,o]=(0,c.useState)([]),d=(0,n.useSupabaseClient)();(0,c.useEffect)(()=>{h()},[]),(0,c.useEffect)(()=>{if(s.length){let e=[];s.map(t=>{e.push(t.id)});let t=async()=>{let{data:t,error:s}=await d.rpc("count_data",{camplist:e});if(!s)return o(t),t;alert(s.message)};t()}},[s]);let h=async()=>{let e=window.sessionStorage.getItem("acid"),{data:t,error:s}=await d.from("campaigns").select("id,name,image_url,created_at,content").eq("shop_id",e).order("created_at",{ascending:!1});if(!s){i(t);return}return console.log(s.message)},m=async e=>{if(!e)return null;if(!0==confirm("ยืนยันลบแคมเปญ?\nข้อมูลจะไม่สามารถกู้คืนได้")){let t=[];t.push(e.content.cover.split("campaigns/")[1]),t.push(e.content.profile.split("campaigns/")[1]),t.push(e.image_url.split("campaigns/")[1]);let{error:s}=await d.from("campaigns").delete().eq("id",e.id);if(!s){let{error:e}=await d.storage.from("campaigns").remove(t);if(e){alert(e.message);return}h();return}alert(s.message)}};return(0,a.jsx)(l.Z,{setPageTitle:"แคมเปญ",setButton:{disabled:!1,children:"สร้างแคมเปญใหม่",onClick:()=>{t.push("/account/".concat(t.query.acid,"/campaign/create"))}},children:(0,a.jsx)(x,{campaigns:s,reports:r,deleteCampaign:m})})}s(5780),m.requireAuth=!0,m.role=["authenticated"]}},function(e){e.O(0,[747,824,774,888,179],function(){return e(e.s=9909)}),_N_E=e.O()}]);