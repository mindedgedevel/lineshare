(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[942],{7262:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/scanqr",function(){return s(1122)}])},1122:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return d}});var n=s(5893),a=s(8802),l=s.n(a),c=s(7294),r=s(9778),i=s(4053),m=s(9464),o=s(7925);function d(e){let{router:t}=e,{cmpid:s,sub:a}=t.query,[d,x]=(0,c.useState)({}),[u,p]=(0,c.useState)(null),[h,f]=(0,c.useState)(null),[g,j]=(0,c.useState)(!1),[N,_]=(0,c.useState)(!1),[w,y]=(0,c.useState)(null),b=(0,i.useSupabaseClient)();(0,c.useEffect)(()=>{if(s&&a){let e=async()=>{let{data:e,error:t}=await b.from("customers").select("*,campaigns(name,content)").eq("camp_id",s).eq("line_id",a);if(t){alert(t.message);return}if(!e.length){alert("ผิดพลาดลิงค์ไม่ถูกต้อง");return}y(e[0])};e()}},[s,a]),(0,c.useEffect)(()=>{p((0,r.jE)("ischeckcode"))},[]);let v=async()=>{if(!s&&!a)return;_(!0);let{data:e,error:t}=await b.from("customers").select("camp_id,line_id,phone").eq("isuse",!1).eq("camp_id",s).eq("line_id",a).eq("phone",w.phone);if(e.length>0&&!t){let e=await b.from("customers").update({isuse:!0}).eq("camp_id",s).eq("line_id",a).eq("phone",w.phone);if(!e.error){j(!0),_(!1);return}alert(e.error.message),_(!1);return}if(0==e.length){alert("เบอร์โทรนี้ยืนยันรับสิทธิ์ไปแล้ว"),_(!1),j(!0);return}alert("ไม่พบข้อมูล"),_(!1)};return(0,n.jsx)("div",{className:"".concat(l().className," min-h-screen flex flex-col items-center py-[20%] bg-slate-200"),children:(0,n.jsxs)("div",{className:"mx-auto max-w-lg",children:[!s&&!a&&(0,n.jsxs)("h1",{className:"text-lg text-center",children:["ผิดพลาดลิงค์เสียหาย ",(0,n.jsx)("br",{}),"ไม่สามารถตรวจสอบสิทธิ์ได้!!!"]}),s&&a&&!u&&(0,n.jsxs)("div",{className:"flex flex-col gap-2 bg-white p-4 shadow-lg rounded-md mx-2",children:[(0,n.jsx)("h1",{className:"text-lg text-center",children:"สำหรับพนักงานยืนยันสิทธิ์หน้าร้านเท่านั้น"}),(0,n.jsxs)("form",{className:"flex flex-col gap-2",onSubmit:e=>{e.preventDefault(),"th3or!g!n"===d.pass?((0,r.w4)("ischeckcode","yes",864e5),p((0,r.jE)("ischeckcode"))):f(!0)},children:[(0,n.jsx)("input",{className:"p-2 rounded-md border border-gray-300",name:"pass",type:"password",placeholder:"กรอกรหัสผ่านที่นี่...",onChange:e=>{let t={...d};t[e.target.name]=e.target.value,x(t)}}),(0,n.jsx)("input",{className:"flex items-center justify-center px-4 py-3 rounded-md bg-green-500 text-gray-100 w-full text-sm cursor-pointer",type:"submit",value:"ตกลง"})]}),h&&(0,n.jsx)("p",{className:"text-sm text-red-400 text-center",children:"รหัสไม่ถูกต้อง!"})]}),s&&a&&u&&!g&&w&&(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"flex flex-col gap-2 bg-white p-4 shadow-lg rounded-md mx-2",children:[(0,n.jsx)("h1",{className:"text-lg text-center",children:"พนักงานยืนยันสิทธิ์หน้าร้าน"}),(0,n.jsxs)("p",{className:"text-sm text-center",children:["คุณ: ",(0,n.jsx)("span",{className:"text-green-800",children:w.name})]}),(0,n.jsxs)("p",{className:"text-sm text-center",children:["เบอร์โทร:"," ",(0,n.jsx)("span",{className:"text-green-800",children:w.phone})]}),(0,n.jsxs)("p",{className:"text-sm text-center",children:["ได้ร่วม ",w.campaigns.name]}),(0,n.jsx)("div",{className:"w-full",children:(0,n.jsx)("img",{alt:"cover",src:w&&w.campaigns.content.cover?w.campaigns.content.cover:"https://placehold.co/420x420"})}),(0,n.jsx)("button",{className:"flex items-center justify-center px-4 py-3 rounded-md bg-green-500 text-gray-100 w-full text-sm",onClick:v,children:N?"กำลังบันทึก...":"กดยืนยันรับสิทธิ์"})]})}),g&&(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"flex flex-col gap-2 bg-white p-4 shadow-lg rounded-md",children:[(0,n.jsx)(m.Z,{options:{loop:!0,autoplay:!0,animationData:o},width:250,height:250}),(0,n.jsx)("p",{className:"text-sm text-center",children:"ยืนยันสิทธิ์เรียบร้อยแล้ว"})]})})]})})}},8802:function(e){e.exports={style:{fontFamily:"'__Anuphan_87802c'",fontStyle:"normal"},className:"__className_87802c"}}},function(e){e.O(0,[296,464,925,774,888,179],function(){return e(e.s=7262)}),_N_E=e.O()}]);